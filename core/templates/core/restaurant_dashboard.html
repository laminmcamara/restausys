{% extends "admin/index.html" %}
{% load static %}

{% block content %}
<style>
.dashboard-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.dashboard-card {
  background: #fff;
  border-radius: 10px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}
.dashboard-card h3 { margin-bottom: 0.5rem; }
.top-items-list li {
  list-style: none;
  margin: 6px 0;
  padding: 4px 0;
  border-bottom: 1px solid #eee;
}
canvas {
  width: 100% !important;
  height: 260px !important;
}
</style>

<div class="dashboard-container">
  <div class="dashboard-card">
    <h3>Today’s Orders</h3>
    <p style="font-size: 2em; font-weight: bold;">{{ today_orders }}</p>
  </div>
  <div class="dashboard-card">
    <h3>Today’s Revenue</h3>
    <p style="font-size: 2em; font-weight: bold;">${{ today_revenue|floatformat:2 }}</p>
  </div>
  <div class="dashboard-card">
    <h3>This Week’s Orders</h3>
    <p style="font-size: 2em; font-weight: bold;">{{ total_orders }}</p>
  </div>
  <div class="dashboard-card">
    <h3>This Week’s Revenue</h3>
    <p style="font-size: 2em; font-weight: bold;">${{ total_revenue|floatformat:2 }}</p>
  </div>
</div>

<div class="dashboard-card">
  <h3>Revenue This Week</h3>
  <canvas id="salesChart"></canvas>
</div>

<div class="dashboard-card">
  <h3>Top 5 Selling Items</h3>
  <ul class="top-items-list">
    {% for item in top_items %}
      <li><strong>{{ item.menu_item__name }}</strong> — {{ item.total_qty }} sold</li>
    {% empty %}
      <li>No items sold this week.</li>
    {% endfor %}
  </ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById("salesChart").getContext("2d");
new Chart(ctx, {
  type: "line",
  data: {
    labels: {{ chart_labels|safe }},
    datasets: [{
      label: "Weekly Revenue ($)",
      data: {{ chart_data|safe }},
      borderColor: "rgba(54, 162, 235, 1)",
      backgroundColor: "rgba(54, 162, 235, 0.1)",
      fill: true,
      borderWidth: 2,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>
{% endblock %}